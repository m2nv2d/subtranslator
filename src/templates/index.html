<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRT Translator</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
            line-height: 1.5;
        }
        form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        label {
            font-weight: bold;
        }
        select, button {
            padding: 0.5rem;
            font-size: 1rem;
        }
        button {
            background: #0066cc;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.75rem;
            cursor: pointer;
        }
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        #status {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 4px;
            display: none;
        }
        .error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ef9a9a;
        }
        .info {
            background: #e3f2fd;
            color: #1565c0;
            border: 1px solid #90caf9;
        }
    </style>
</head>
<body>
    <h1>SRT Subtitle Translator</h1>
    <form id="uploadForm" enctype="multipart/form-data">
        <div class="form-group">
            <label for="file">SRT File (max 2MB):</label>
            <input type="file" id="file" name="file" accept=".srt" required>
        </div>
        
        <div class="form-group">
            <label for="target_lang">Target Language:</label>
            <select id="target_lang" name="target_lang" required>
                <option value="">Select language...</option>
                {% for lang in languages %}
                <option value="{{ lang }}">{{ lang }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="speed_mode">Translation Speed:</label>
            <select id="speed_mode" name="speed_mode">
                <option value="normal">Normal (Higher Quality)</option>
                <option value="fast">Fast (Lower Quality)</option>
            </select>
        </div>

        <button type="submit" id="submitBtn">Translate</button>
    </form>

    <div id="status"></div>

    <script>
        const form = document.getElementById('uploadForm');
        const submitBtn = document.getElementById('submitBtn');
        const status = document.getElementById('status');

        function showStatus(message, type) {
            status.textContent = message;
            status.className = type;
            status.style.display = 'block';
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(form);
            
            // Basic validation
            const file = formData.get('file');
            if (!file) {
                showStatus('Please select a file', 'error');
                return;
            }
            if (!file.name.toLowerCase().endsWith('.srt')) {
                showStatus('Only .srt files are allowed', 'error');
                return;
            }
            if (file.size > 2 * 1024 * 1024) {
                showStatus('File size must be less than 2MB', 'error');
                return;
            }

            // Disable form and show processing status
            submitBtn.disabled = true;
            showStatus('Translating...', 'info');

            try {
                const response = await fetch('/translate', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = file.name.replace('.srt', `_${formData.get('target_lang')}.srt`);
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    showStatus('Translation complete! Check your downloads.', 'info');
                } else {
                    const error = await response.json();
                    showStatus(error.error || 'Translation failed', 'error');
                }
            } catch (error) {
                showStatus('Network error occurred', 'error');
            } finally {
                submitBtn.disabled = false;
            }
        });
    </script>
</body>
</html>